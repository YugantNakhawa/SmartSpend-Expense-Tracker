<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #f8fafc;
            --accent-color: #06b6d4;
            --text-dark: #1e293b;
            --border-color: #e2e8f0;
            --success-color: #10b981;
            --danger-color: #ef4444;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .dashboard-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            padding: 0;
            overflow: hidden;
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .dashboard-header h1 {
            font-weight: 300;
            font-size: 2.5rem;
            margin: 0;
        }

        .dashboard-header .subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
            margin-top: 0.5rem;
        }

        .nav-tabs {
            border: none;
            background: var(--secondary-color);
            padding: 0 2rem;
        }

        .nav-tabs .nav-link {
            border: none;
            color: var(--text-dark);
            font-weight: 500;
            padding: 1rem 1.5rem;
            margin-right: 0.5rem;
            border-radius: 15px 15px 0 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tabs .nav-link:hover {
            background: rgba(79, 70, 229, 0.1);
            transform: translateY(-2px);
        }

        .nav-tabs .nav-link.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-tabs .nav-link i {
            margin-right: 0.5rem;
        }

        .tab-content {
            padding: 2rem;
            background: white;
        }

        .stats-row {
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            opacity: 0.9;
            margin: 0;
        }

        .form-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .form-control, .form-select {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.25);
        }

        .btn-custom {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border: none;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 500;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
            color: white;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .table {
            margin: 0;
        }

        .table thead th {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: none;
            font-weight: 600;
            color: var(--text-dark);
            padding: 1rem;
        }

        .table tbody td {
            padding: 1rem;
            border-color: var(--border-color);
            vertical-align: middle;
        }

        .table tbody tr:hover {
            background: rgba(79, 70, 229, 0.05);
        }

        .btn-sm {
            border-radius: 8px;
            padding: 0.375rem 0.75rem;
            font-weight: 500;
        }

        .btn-danger {
            background: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-success {
            background: var(--success-color);
            border-color: var(--success-color);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #64748b;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .search-box {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-box input {
            padding-left: 3rem;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                margin: 1rem;
                border-radius: 15px;
            }
            
            .dashboard-header {
                padding: 1.5rem;
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
            
            .tab-content {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="dashboard-container">
            <!-- Header -->
            <div class="dashboard-header">
                <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
                <p class="subtitle">Manage users and expenses with ease</p>
            </div>

            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                        <i class="fas fa-chart-pie"></i> Overview
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">
                        <i class="fas fa-users"></i> Users
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="expenses-tab" data-bs-toggle="tab" data-bs-target="#expenses" type="button" role="tab">
                        <i class="fas fa-receipt"></i> Expenses
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="add-user-tab" data-bs-toggle="tab" data-bs-target="#add-user" type="button" role="tab">
                        <i class="fas fa-user-plus"></i> Add User
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="dashboardTabContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                    <div class="row stats-row">
                        <div class="col-md-4 mb-3">
                            <div class="stat-card">
                                <i class="fas fa-users fa-2x mb-3"></i>
                                <h3 th:text="${#lists.size(users)} ?: '0'">0</h3>
                                <p>Total Users</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="stat-card">
                                <i class="fas fa-receipt fa-2x mb-3"></i>
                                <h3 th:text="${#lists.size(expenses)} ?: '0'">0</h3>
                                <p>Total Expenses</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="stat-card">
                                <i class="fas fa-dollar-sign fa-2x mb-3"></i>
                                <h3 th:text="${totalAmount} ?: '$0'">$0</h3>
                                <p>Total Amount</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="form-card">
                                <h5 class="mb-3"><i class="fas fa-user-shield"></i> Recent Admin Actions</h5>
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="fas fa-user-plus text-success me-2"></i>
                                            User registration enabled
                                        </div>
                                        <small class="text-muted">2 hrs ago</small>
                                    </div>
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <i class="fas fa-database text-info me-2"></i>
                                            Database backup completed
                                        </div>
                                        <small class="text-muted">1 day ago</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="form-card">
                                <h5 class="mb-3"><i class="fas fa-bell"></i> System Status</h5>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Server Status</span>
                                    <span class="badge bg-success">Online</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>Database Connection</span>
                                    <span class="badge bg-success">Active</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Last Backup</span>
                                    <span class="badge bg-info">24 hrs ago</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div class="tab-pane fade" id="users" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="fas fa-users"></i> User Management</h4>
                        <button class="btn btn-custom" onclick="document.getElementById('add-user-tab').click();">
                            <i class="fas fa-plus"></i> Add New User
                        </button>
                    </div>

                    <!-- Search Box -->
                    <div class="search-box">
                        <input type="text" class="form-control" id="userSearch" placeholder="Search users...">
                        <i class="fas fa-search"></i>
                    </div>

                    <div class="data-table">
                        <div th:if="${#lists.isEmpty(users)}" class="empty-state">
                            <i class="fas fa-users"></i>
                            <h5>No users found</h5>
                            <p>Start by adding your first user to the system.</p>
                        </div>
                        <table th:unless="${#lists.isEmpty(users)}" class="table table-hover" id="usersTable">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-hashtag"></i> ID</th>
                                    <th><i class="fas fa-user"></i> Username</th>
                                    <th><i class="fas fa-envelope"></i> Email</th>
                                    <th><i class="fas fa-shield-alt"></i> Role</th>
                                    <th><i class="fas fa-cogs"></i> Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="user : ${users}">
                                    <td th:text="${user.id}">USER001</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle me-2">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <span th:text="${user.username}">username</span>
                                        </div>
                                    </td>
                                    <td th:text="${user.email}">email@example.com</td>
                                    <td>
                                        <span class="badge" th:class="${user.role == 'ROLE_ADMIN'} ? 'bg-danger' : 'bg-primary'" th:text="${user.role}">ROLE_USER</span>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-primary btn-sm me-1" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <a th:href="@{/admin/delete-user/{id}(id=${user.id})}" 
                                           class="btn btn-danger btn-sm" 
                                           onclick="return confirm('Are you sure you want to delete this user?');"
                                           title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Expenses Tab -->
                <div class="tab-pane fade" id="expenses" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="fas fa-receipt"></i> Expense Management</h4>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button class="btn btn-outline-success">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>

                    <!-- Search Box -->
                    <div class="search-box">
                        <input type="text" class="form-control" id="expenseSearch" placeholder="Search expenses...">
                        <i class="fas fa-search"></i>
                    </div>

                    <div class="data-table">
                        <div th:if="${#lists.isEmpty(expenses)}" class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <h5>No expenses found</h5>
                            <p>Expenses will appear here once users start adding them.</p>
                        </div>
                        <table th:unless="${#lists.isEmpty(expenses)}" class="table table-hover" id="expensesTable">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-hashtag"></i> ID</th>
                                    <th><i class="fas fa-user"></i> User</th>
                                    <th><i class="fas fa-tag"></i> Title</th>
                                    <th><i class="fas fa-dollar-sign"></i> Amount</th>
                                    <th><i class="fas fa-list"></i> Category</th>
                                    <th><i class="fas fa-calendar"></i> Date</th>
                                    <th><i class="fas fa-cogs"></i> Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="expense : ${expenses}">
                                    <td th:text="${expense.id}">1</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle me-2">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <span th:text="${expense.user.username}">user</span>
                                        </div>
                                    </td>
                                    <td th:text="${expense.title}">title</td>
                                    <td>
                                        <span class="fw-bold text-success" th:text="'$' + ${expense.amount}">$100.0</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary" th:text="${expense.category}">Food</span>
                                    </td>
                                    <td th:text="${expense.date}">2025-09-05</td>
                                    <td>
                                        <button class="btn btn-outline-info btn-sm me-1" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <a th:href="@{/admin/delete-expense/{id}(id=${expense.id})}" 
                                           class="btn btn-danger btn-sm" 
                                           onclick="return confirm('Are you sure you want to delete this expense?');"
                                           title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add User Tab -->
                <div class="tab-pane fade" id="add-user" role="tabpanel">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="form-card">
                                <div class="text-center mb-4">
                                    <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
                                    <h4>Add New User</h4>
                                    <p class="text-muted">Fill in the details below to create a new user account</p>
                                </div>

                                <form th:action="@{/admin/add-user}" method="post">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="username" class="form-label">
                                                    <i class="fas fa-user"></i> Username
                                                </label>
                                                <input type="text" 
                                                       name="username" 
                                                       class="form-control" 
                                                       id="username" 
                                                       placeholder="Enter username"
                                                       required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="email" class="form-label">
                                                    <i class="fas fa-envelope"></i> Email
                                                </label>
                                                <input type="email" 
                                                       name="email" 
                                                       class="form-control" 
                                                       id="email" 
                                                       placeholder="Enter email address"
                                                       required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="role" class="form-label">
                                                    <i class="fas fa-shield-alt"></i> Role
                                                </label>
                                                <select name="role" id="role" class="form-select" required>
                                                    <option value="">Select a role</option>
                                                    <option value="ROLE_USER">User</option>
                                                    <option value="ROLE_ADMIN">Admin</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="password" class="form-label">
                                                    <i class="fas fa-lock"></i> Password
                                                </label>
                                                <input type="password" 
                                                       name="password" 
                                                       class="form-control" 
                                                       id="password" 
                                                       placeholder="Enter password"
                                                       required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button type="reset" class="btn btn-outline-secondary me-2">
                                            <i class="fas fa-undo"></i> Reset
                                        </button>
                                        <button type="submit" class="btn btn-custom">
                                            <i class="fas fa-plus"></i> Add User
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Search functionality for users table
        document.getElementById('userSearch')?.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('#usersTable tbody tr');
            
            tableRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Search functionality for expenses table
        document.getElementById('expenseSearch')?.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('#expensesTable tbody tr');
            
            tableRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Form validation
        document.querySelector('form')?.addEventListener('submit', function(e) {
            const requiredFields = this.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
            }
        });

        // Auto-hide alerts after 5 seconds
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);
    </script>

    <style>
        .avatar-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .is-invalid {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 0.2rem rgba(239, 68, 68, 0.25) !important;
        }
    </style>
</body>
</html>