<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartSpend - Smart Expense Tracking System</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --secondary: #f1f5f9;
      --accent: #06b6d4;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1e293b;
      --gray: #64748b;
      --light-gray: #f8fafc;
      --border: #e2e8f0;
      --shadow: rgba(0, 0, 0, 0.1);
      --gradient: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--dark);
      line-height: 1.6;
    }

    /* Loading Spinner */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .loading-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--border);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 1rem 0;
      margin-bottom: 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .logo i {
      font-size: 2rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn-header {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .btn-header:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    /* Dashboard Grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    /* Sidebar */
    .sidebar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 1.5rem;
      height: fit-content;
      box-shadow: 0 10px 40px var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .quick-stats {
      margin-bottom: 2rem;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--light-gray);
      border-radius: 12px;
      margin-bottom: 0.75rem;
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      background: var(--secondary);
      transform: translateX(3px);
    }

    .stat-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: var(--gray);
    }

    .stat-value {
      font-weight: 600;
      color: var(--dark);
    }

    /* Navigation */
    .nav-menu {
      list-style: none;
    }

    .nav-item {
      margin-bottom: 0.5rem;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      color: var(--gray);
      text-decoration: none;
      border-radius: 10px;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-link:hover,
    .nav-link.active {
      background: var(--gradient);
      color: white;
      transform: translateX(3px);
    }

    /* Main Content */
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* Cards */
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 40px var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      margin-bottom: 14px;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--secondary);
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--dark);
    }

    /* Form Styles */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .form-group {
      position: relative;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }

    .form-control {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }

    .btn {
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      justify-content: center;
    }

    .btn-primary {
      background: var(--gradient);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
    }

    .btn-secondary {
      background: var(--secondary);
      color: var(--gray);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    /* Statistics Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--gradient);
      color: white;
      padding: 1.5rem;
      border-radius: 15px;
      text-align: center;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s;
    }

    .stat-card:hover::before {
      left: 100%;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .stat-text {
      opacity: 0.9;
      font-size: 0.9rem;
    }

    /* Chart Container */
    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 1rem;
    }

    .chart-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .chart-tab {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 2px solid var(--primary);
      border-radius: 25px;
      color: var(--primary);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .chart-tab.active {
      background: var(--primary);
      color: white;
    }

    /* Expense List */
    .expense-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .expense-item {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .expense-item:hover {
      border-color: var(--primary);
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.1);
    }

    .expense-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .expense-title {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--dark);
    }

    .expense-amount {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--danger);
    }

    .expense-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      color: var(--gray);
    }

    .expense-category {
      background: var(--gradient);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: white;
      border-radius: 10px;
      padding: 1rem 1.5rem;
      box-shadow: 0 10px 40px var(--shadow);
      border-left: 4px solid var(--success);
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.error {
      border-left-color: var(--danger);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--gray);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Budget Progress Bar */
    .budget-progress {
      margin-top: 1rem;
      margin-bottom: 1rem;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--secondary);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--gray);
      margin-top: 0.5rem;
    }

    /* Data Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px var(--shadow);
    }

    .data-table th,
    .data-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .data-table th {
      background: var(--secondary);
      font-weight: 600;
      color: var(--dark);
    }

    .data-table tr:hover {
      background: var(--light-gray);
    }
    
    /* Enhanced Chatbot Styles */
    #chatbot {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 10000;
      font-family: inherit;
      max-width: 380px;
      width: 380px;
    }

    #chatbotHeader {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      padding: 16px 20px;
      border-radius: 50px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    #chatbotHeader::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }

    #chatbotHeader:hover::before {
      left: 100%;
    }

    #chatbotHeader:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 35px rgba(59, 130, 246, 0.4);
    }

    #chatbotHeader.expanded {
      border-radius: 20px 20px 0 0;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
    }

    #chatbotHeaderText {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      font-size: 15px;
    }

    #chatbotHeaderIcon {
      font-size: 20px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    #chatbotClose {
      display: none;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    #chatbotClose:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    #chatbotBody {
      display: none;
      flex-direction: column;
      width: 100%;
      height: 450px;
      background: white;
      border-radius: 0 0 20px 20px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      transform: translateY(-10px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(59, 130, 246, 0.1);
    }

    #chatbotBody.show {
      display: flex;
      transform: translateY(0);
      opacity: 1;
    }

    #chatMessages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: linear-gradient(to bottom, #f8fafc, #f1f5f9);
      position: relative;
    }

    #chatMessages::-webkit-scrollbar {
      width: 6px;
    }

    #chatMessages::-webkit-scrollbar-track {
      background: transparent;
    }

    #chatMessages::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.3);
      border-radius: 3px;
    }

    .message {
      padding: 12px 16px;
      border-radius: 18px;
      max-width: 85%;
      word-wrap: break-word;
      position: relative;
      animation: messageSlide 0.3s ease-out;
    }

    @keyframes messageSlide {
      from { 
        opacity: 0; 
        transform: translateY(10px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    .userMessage {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 6px;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    .botMessage {
      background: white;
      color: #1e293b;
      align-self: flex-start;
      border-bottom-left-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
    }

    .typing-indicator {
      align-self: flex-start;
      background: white;
      border-radius: 18px;
      border-bottom-left-radius: 6px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
    }

    .typing-dots {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #64748b;
      animation: typingBounce 1.4s infinite ease-in-out both;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typingBounce {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    #chatInputArea {
      display: flex;
      padding: 16px;
      border-top: 1px solid #e2e8f0;
      background: white;
      gap: 12px;
      align-items: flex-end;
    }

    #chatInputArea input {
      flex: 1;
      padding: 12px 16px;
      border-radius: 25px;
      border: 2px solid #e2e8f0;
      outline: none;
      font-size: 14px;
      transition: all 0.2s ease;
      max-height: 80px;
      resize: none;
    }

    #chatInputArea input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    #chatInputArea button {
      padding: 12px 16px;
      border: none;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    #chatInputArea button:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    #chatInputArea button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .hidden {
      display: none !important;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        order: 2;
      }
      
      .main-content {
        order: 1;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 1rem;
      }
      
      .header-content {
        padding: 0 1rem;
        flex-direction: column;
        gap: 1rem;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .filters {
        flex-direction: column;
        align-items: stretch;
      }

      #chatbot {
        right: 15px;
        bottom: 15px;
        width: calc(100vw - 30px);
        max-width: 350px;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-chart-line"></i>
        <span>ExpenseFlow Pro</span>
      </div>
      <div class="header-actions">
        <button class="btn-header" onclick="exportData()">
          <i class="fas fa-download"></i> Export
        </button>
        <button class="btn-header" onclick="showBudgetModal()">
          <i class="fas fa-piggy-bank"></i> Budget
        </button>
        <button class="btn-header" onclick="toggleTheme()">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="dashboard-grid">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="quick-stats">
          <h3 style="margin-bottom: 1rem; color: var(--dark);">Quick Stats</h3>
          <div class="stat-item">
            <div class="stat-label">
              <i class="fas fa-wallet"></i>
              Total Spent
            </div>
            <div class="stat-value" id="totalSpent">$0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">
              <i class="fas fa-calendar-day"></i>
              Today
            </div>
            <div class="stat-value" id="todaySpent">$0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">
              <i class="fas fa-calendar-week"></i>
              This Week
            </div>
            <div class="stat-value" id="weekSpent">$0</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">
              <i class="fas fa-calendar-alt"></i>
              This Month
            </div>
            <div class="stat-value" id="monthSpent">$0</div>
          </div>
        </div>

        <!-- Budget Progress -->
        <div class="budget-progress" id="budgetSection" style="display: none;">
          <h4 style="margin-bottom: 0.5rem; color: var(--dark);">Monthly Budget</h4>
          <div class="progress-bar">
            <div class="progress-fill" id="budgetProgress"></div>
          </div>
          <div class="progress-text">
            <span id="budgetUsed">$0</span>
            <span id="budgetTotal">$0</span>
          </div>
        </div>

        <!-- Navigation -->
        <nav>
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="#" class="nav-link active" data-section="dashboard">
                <i class="fas fa-home"></i>
                Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-section="expenses">
                <i class="fas fa-list"></i>
                All Expenses
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-section="analytics">
                <i class="fas fa-chart-bar"></i>
                Analytics
              </a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" data-section="reports">
                <i class="fas fa-file-alt"></i>
                Reports
              </a>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboardSection">
          <!-- Stats Grid -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="totalExpenses">$0</div>
              <div class="stat-text">Total Expenses</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="monthlyAverage">$0</div>
              <div class="stat-text">Monthly Average</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="expenseCount">0</div>
              <div class="stat-text">Transactions</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="topCategory">-</div>
              <div class="stat-text">Top Category</div>
            </div>
          </div>

          <!-- Add Expense Form -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-plus-circle"></i>
                Add New Expense
              </h2>
            </div>
            <form class="form-grid" id="expenseForm">
              <div class="form-group">
                <label class="form-label">Title</label>
                <input type="text" class="form-control" id="title" required>
              </div>
              <div class="form-group">
                <label class="form-label">Amount ($)</label>
                <input type="number" class="form-control" id="amount" step="0.01" min="0" required>
              </div>
              <div class="form-group">
                <label class="form-label">Category</label>
                <select class="form-control" id="category" required>
                  <option value="">Select Category</option>
                  <option value="Food">🍔 Food & Dining</option>
                  <option value="Transport">🚗 Transportation</option>
                  <option value="Entertainment">🎬 Entertainment</option>
                  <option value="Utilities">💡 Utilities</option>
                  <option value="Healthcare">🏥 Healthcare</option>
                  <option value="Shopping">🛍️ Shopping</option>
                  <option value="Education">📚 Education</option>
                  <option value="Travel">✈️ Travel</option>
                  <option value="Other">📝 Other</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" class="form-control" id="date" required>
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label class="form-label">Description (Optional)</label>
                <input type="text" class="form-control" id="description" placeholder="Add a note...">
              </div>
              <button type="submit" class="btn btn-primary" style="grid-column: 1 / -1;">
                <i class="fas fa-plus"></i>
                Add Expense
              </button>
            </form>
          </div>

          <!-- Charts -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-chart-pie"></i>
                Financial Analytics
              </h2>
              <div class="chart-tabs">
                <button class="chart-tab active" onclick="showChart('category')">Category</button>
                <button class="chart-tab" onclick="showChart('monthly')">Monthly</button>
                <button class="chart-tab" onclick="showChart('daily')">Daily</button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="expenseChart"></canvas>
            </div>
          </div>

          <!-- Recent Expenses -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-history"></i>
                Recent Expenses
              </h2>
              <button class="btn btn-secondary" onclick="showAllExpenses()">
                View All
              </button>
            </div>
            <div class="filters">
              <div class="filter-group">
                <label>Category:</label>
                <select class="form-control" id="categoryFilter" style="width: auto;">
                  <option value="">All</option>
                  <option value="Food">Food</option>
                  <option value="Transport">Transport</option>
                  <option value="Entertainment">Entertainment</option>
                  <option value="Utilities">Utilities</option>
                  <option value="Healthcare">Healthcare</option>
                  <option value="Shopping">Shopping</option>
                  <option value="Education">Education</option>
                  <option value="Travel">Travel</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="filter-group">
                <label>Search:</label>
                <input type="text" class="form-control" id="searchFilter" placeholder="Search expenses..." style="width: 200px;">
              </div>
            </div>
            <div class="expense-list" id="expenseList">
              <div class="empty-state">
                <i class="fas fa-receipt"></i>
                <h3>No expenses yet</h3>
                <p>Add your first expense to get started!</p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Enhanced Chatbot Widget -->
  <div id="chatbot">
    <div id="chatbotHeader" onclick="toggleChatbot()">
      <div id="chatbotHeaderText">
        <span id="chatbotHeaderIcon">💬</span>
        <span>Chat with AI Assistant</span>
      </div>
      <span id="chatbotClose" onclick="toggleChatbot(event)">×</span>
    </div>
    <div id="chatbotBody">
      <div id="chatMessages">
        <div class="message botMessage">
          <span>Hi! I'm your AI financial assistant. Ask me anything about your expenses, budgeting tips, or financial insights!</span>
        </div>
      </div>
      <div id="chatInputArea">
        <input 
          type="text" 
          id="llmQuestion" 
          placeholder="Ask about your expenses..."
          onkeypress="handleChatKeyPress(event)"
        />
        <button onclick="askLLM()" id="sendButton">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script>
    // Configuration
    const API_URL = "http://localhost:6788/expenses";
    const API_POST_URL = "http://localhost:6788/expensesoutput";
    
    // Global Variables
    let expenses = [];
    let currentChart = null;
    let currentChartType = 'category';
    let monthlyBudget = 0;
    let chatbotOpen = false;

    // Initialize App
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    async function initializeApp() {
      showLoading(true);
      
      // Set default date
      document.getElementById('date').valueAsDate = new Date();
      
      // Load saved budget
      monthlyBudget = parseFloat(localStorage.getItem('monthlyBudget') || '0');
      if (monthlyBudget > 0) {
        document.getElementById('budgetSection').style.display = 'block';
        document.getElementById('budgetTotal').textContent = `${monthlyBudget}`;
      }
      
      // Event listeners
      document.getElementById('expenseForm').addEventListener('submit', addExpense);
      document.getElementById('categoryFilter').addEventListener('change', filterExpenses);
      document.getElementById('searchFilter').addEventListener('input', debounce(filterExpenses, 300));
      
      // Navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', handleNavigation);
      });
      
      // Load data
      await fetchExpenses();
      showLoading(false);
    }

    // Loading State
    function showLoading(show) {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.toggle('active', show);
    }

    // API Functions
    async function fetchExpenses() {
      try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('Failed to fetch expenses');
        
        expenses = await response.json();
        
        // Update all UI components
        updateStats();
        updateQuickStats();
        updateBudgetProgress();
        renderRecentExpenses();
        showChart(currentChartType);
        
      } catch (error) {
        console.error('Error fetching expenses:', error);
        showToast('Error loading expenses. Please check your connection.', 'error');
        // Use demo data for development
        expenses = generateDemoData();
        updateStats();
        updateQuickStats();
        updateBudgetProgress();
        renderRecentExpenses();
        showChart(currentChartType);
      }
    }

    // Generate demo data for development
    function generateDemoData() {
      const categories = ['Food', 'Transport', 'Entertainment', 'Utilities', 'Shopping'];
      const demoExpenses = [];
      const today = new Date();
      
      for (let i = 0; i < 20; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() - Math.floor(Math.random() * 30));
        
        demoExpenses.push({
          id: i + 1,
          title: `Demo Expense ${i + 1}`,
          amount: Math.floor(Math.random() * 200) + 10,
          category: categories[Math.floor(Math.random() * categories.length)],
          date: date.toISOString().split('T')[0],
          description: `Demo description for expense ${i + 1}`
        });
      }
      
      return demoExpenses;
    }

    async function addExpense(e) {
      e.preventDefault();
      showLoading(true);
      
      const expense = {
        title: document.getElementById('title').value,
        amount: parseFloat(document.getElementById('amount').value),
        category: document.getElementById('category').value,
        date: document.getElementById('date').value,
        description: document.getElementById('description').value || ''
      };
      
      try {
        const response = await fetch(API_POST_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(expense)
        });
        
        if (!response.ok) throw new Error('Failed to add expense');
        
        // Reset form
        document.getElementById('expenseForm').reset();
        document.getElementById('date').valueAsDate = new Date();
        
        // Refresh data
        await fetchExpenses();
        showToast('Expense added successfully!', 'success');
        
      } catch (error) {
        console.error('Error adding expense:', error);
        // Add to demo data for development
        expense.id = Date.now();
        expenses.unshift(expense);
        updateStats();
        updateQuickStats();
        updateBudgetProgress();
        renderRecentExpenses();
        showChart(currentChartType);
        
        // Reset form
        document.getElementById('expenseForm').reset();
        document.getElementById('date').valueAsDate = new Date();
        
        showToast('Expense added successfully! (Demo mode)', 'success');
      } finally {
        showLoading(false);
      }
    }

    // Delete Function
    async function deleteExpense(id) {
      if (!confirm('Are you sure you want to delete this expense?')) return;
      
      try {
        const response = await fetch(`${API_URL}/${id}`, {
          method: 'DELETE'
        });
        
        if (!response.ok) throw new Error('Failed to delete expense');
        
        await fetchExpenses();
        showToast('Expense deleted successfully!', 'success');
        
      } catch (error) {
        console.error('Error deleting expense:', error);
        // Remove from demo data for development
        expenses = expenses.filter(exp => exp.id !== id);
        updateStats();
        updateQuickStats();
        updateBudgetProgress();
        renderRecentExpenses();
        showChart(currentChartType);
        showToast('Expense deleted successfully! (Demo mode)', 'success');
      }
    }

    // Statistics Updates
    function updateStats() {
      const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      const count = expenses.length;
      
      // Calculate monthly average
      const months = new Set(expenses.map(exp => exp.date.substring(0, 7))).size;
      const monthlyAvg = months > 0 ? total / months : 0;
      
      // Find top category
      const categoryTotals = {};
      expenses.forEach(exp => {
        categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
      });
      const topCategory = Object.keys(categoryTotals).reduce((a, b) => 
        categoryTotals[a] > categoryTotals[b] ? a : b, '-'
      );

      document.getElementById('totalExpenses').textContent = formatCurrency(total);
      document.getElementById('monthlyAverage').textContent = formatCurrency(monthlyAvg);
      document.getElementById('expenseCount').textContent = count;
      document.getElementById('topCategory').textContent = topCategory;
    }

    function updateQuickStats() {
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      const weekStart = new Date(now.setDate(now.getDate() - now.getDay())).toISOString().split('T')[0];
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
      
      const todayTotal = expenses
        .filter(exp => exp.date === today)
        .reduce((sum, exp) => sum + exp.amount, 0);
        
      const weekTotal = expenses
        .filter(exp => exp.date >= weekStart)
        .reduce((sum, exp) => sum + exp.amount, 0);
        
      const monthTotal = expenses
        .filter(exp => exp.date >= monthStart)
        .reduce((sum, exp) => sum + exp.amount, 0);
      
      const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
      
      document.getElementById('totalSpent').textContent = formatCurrency(total);
      document.getElementById('todaySpent').textContent = formatCurrency(todayTotal);
      document.getElementById('weekSpent').textContent = formatCurrency(weekTotal);
      document.getElementById('monthSpent').textContent = formatCurrency(monthTotal);
    }

    function updateBudgetProgress() {
      if (monthlyBudget <= 0) return;
      
      const now = new Date();
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
      const monthTotal = expenses
        .filter(exp => exp.date >= monthStart)
        .reduce((sum, exp) => sum + exp.amount, 0);
      
      const percentage = Math.min((monthTotal / monthlyBudget) * 100, 100);
      
      document.getElementById('budgetProgress').style.width = percentage + '%';
      document.getElementById('budgetUsed').textContent = formatCurrency(monthTotal);
      
      // Change color based on usage
      const progressFill = document.getElementById('budgetProgress');
      if (percentage > 90) {
        progressFill.style.background = 'linear-gradient(135deg, var(--danger), #dc2626)';
      } else if (percentage > 70) {
        progressFill.style.background = 'linear-gradient(135deg, var(--warning), #d97706)';
      } else {
        progressFill.style.background = 'var(--gradient)';
      }
    }

    // Render Functions
    function renderRecentExpenses(limit = 10) {
      const container = document.getElementById('expenseList');
      const filteredExpenses = getFilteredExpenses().slice(0, limit);
      
      if (filteredExpenses.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-receipt"></i>
            <h3>No expenses found</h3>
            <p>Try adjusting your filters or add some expenses.</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filteredExpenses.map(expense => `
        <div class="expense-item">
          <div class="expense-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div class="expense-title">${expense.title}</div>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <div class="expense-amount">${formatCurrency(expense.amount)}</div>
              <button class="btn btn-danger" style="padding: 0.5rem; font-size: 0.8rem;" 
                      onclick="deleteExpense(${expense.id})" title="Delete expense">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          <div class="expense-meta">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <span class="expense-category">${expense.category}</span>
              ${expense.description ? `<span style="font-style: italic;">${expense.description}</span>` : ''}
            </div>
            <div>${formatDate(expense.date)}</div>
          </div>
        </div>
      `).join('');
    }

    function getFilteredExpenses() {
      const categoryFilter = document.getElementById('categoryFilter').value;
      const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
      
      return expenses
        .filter(expense => {
          const matchesCategory = !categoryFilter || expense.category === categoryFilter;
          const matchesSearch = !searchFilter || 
            expense.title.toLowerCase().includes(searchFilter) ||
            expense.category.toLowerCase().includes(searchFilter) ||
            (expense.description && expense.description.toLowerCase().includes(searchFilter));
          
          return matchesCategory && matchesSearch;
        })
        .sort((a, b) => new Date(b.date) - new Date(a.date));
    }

    function filterExpenses() {
      renderRecentExpenses();
    }

    // Chart Functions
    function showChart(chartType) {
      currentChartType = chartType;

      // Update active tab
      document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
      const activeTab = Array.from(document.querySelectorAll('.chart-tab')).find(tab => 
        tab.textContent.toLowerCase() === chartType
      );
      if (activeTab) activeTab.classList.add('active');

      // Destroy existing chart
      if (currentChart) {
        currentChart.destroy();
      }

      const canvas = document.getElementById('expenseChart');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');

      switch (chartType) {
        case 'category':
          renderCategoryChart(ctx);
          break;
        case 'monthly':
          renderMonthlyChart(ctx);
          break;
        case 'daily':
          renderDailyChart(ctx);
          break;
        default:
          console.warn('Unknown chart type:', chartType);
      }
    }

    function renderCategoryChart(ctx) {
      const categoryTotals = {};
      expenses.forEach(exp => {
        categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
      });

      const colors = [
        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', 
        '#FF9F40', '#FF6384', '#4BC0C0', '#36A2EB'
      ];
      
      currentChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(categoryTotals),
          datasets: [{
            data: Object.values(categoryTotals),
            backgroundColor: colors,
            borderWidth: 0,
            hoverOffset: 15
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 20,
                usePointStyle: true,
                font: { size: 12 }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((context.parsed / total) * 100).toFixed(1);
                  return `${context.label}: ${formatCurrency(context.parsed)} (${percentage}%)`;
                }
              }
            }
          },
          animation: {
            animateRotate: true,
            duration: 1000
          }
        }
      });
    }

    function renderMonthlyChart(ctx) {
      const monthlyTotals = {};
      expenses.forEach(exp => {
        const month = exp.date.substring(0, 7);
        monthlyTotals[month] = (monthlyTotals[month] || 0) + exp.amount;
      });

      const sortedMonths = Object.keys(monthlyTotals).sort();
      
      currentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: sortedMonths.map(month => {
            const date = new Date(month + '-01');
            return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
          }),
          datasets: [{
            label: 'Monthly Expenses',
            data: sortedMonths.map(month => monthlyTotals[month]),
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: 'rgb(59, 130, 246)',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatCurrency(value);
                }
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              }
            },
            x: {
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Total: ${formatCurrency(context.parsed.y)}`;
                }
              }
            }
          },
          animation: {
            duration: 1000,
            easing: 'easeOutQuart'
          }
        }
      });
    }

    function renderDailyChart(ctx) {
      // Get last 30 days
      const dailyTotals = {};
      const now = new Date();
      
      for (let i = 29; i >= 0; i--) {
        const date = new Date(now);
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        dailyTotals[dateStr] = 0;
      }
      
      expenses.forEach(exp => {
        if (dailyTotals.hasOwnProperty(exp.date)) {
          dailyTotals[exp.date] += exp.amount;
        }
      });

      const dates = Object.keys(dailyTotals).sort();
      
      currentChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dates.map(date => {
            const d = new Date(date);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
          }),
          datasets: [{
            label: 'Daily Expenses',
            data: dates.map(date => dailyTotals[date]),
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderColor: 'rgb(59, 130, 246)',
            borderWidth: 1,
            borderRadius: 4,
            borderSkipped: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return formatCurrency(value);
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Amount: ${formatCurrency(context.parsed.y)}`;
                }
              }
            }
          }
        }
      });
    }

    // Enhanced Chatbot Functions
    function toggleChatbot(event) {
      if (event) event.stopPropagation();
      
      const body = document.getElementById('chatbotBody');
      const header = document.getElementById('chatbotHeader');
      const closeBtn = document.getElementById('chatbotClose');
      
      chatbotOpen = !chatbotOpen;
      
      if (chatbotOpen) {
        body.classList.add('show');
        header.classList.add('expanded');
        closeBtn.style.display = 'flex';
        
        // Focus input when opened
        setTimeout(() => {
          document.getElementById('llmQuestion').focus();
        }, 300);
      } else {
        body.classList.remove('show');
        header.classList.remove('expanded');
        closeBtn.style.display = 'none';
      }
    }

    function handleChatKeyPress(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        askLLM();
      }
    }

    async function askLLM() {
    	  const questionInput = document.getElementById('llmQuestion');
    	  const question = questionInput.value.trim();
    	  if (!question) return;

    	  const messages = document.getElementById('chatMessages');
    	  const sendButton = document.getElementById('sendButton');

    	  // Add user message
    	  const userMsg = document.createElement('div');
    	  userMsg.className = 'message userMessage';
    	  userMsg.textContent = question;
    	  messages.appendChild(userMsg);
    	  messages.scrollTop = messages.scrollHeight;

    	  questionInput.value = '';
    	  sendButton.disabled = true;

    	  // Show typing indicator
    	  const typingIndicator = document.createElement('div');
    	  typingIndicator.className = 'typing-indicator';
    	  typingIndicator.innerHTML = `
    	    <div class="typing-dots">
    	      <div class="typing-dot"></div>
    	      <div class="typing-dot"></div>
    	      <div class="typing-dot"></div>
    	    </div>
    	  `;
    	  messages.appendChild(typingIndicator);
    	  messages.scrollTop = messages.scrollHeight;

    	  try {
    	    // Real API call to the backend
    	    const response = await fetch('/llm/ask', {
    	      method: 'POST',
    	      headers: {
    	        'Content-Type': 'application/json'
    	      },
    	      body: JSON.stringify({ question: question })
    	    });

    	    if (!response.ok) {
    	      throw new Error('Network response was not ok');
    	    }

    	    const data = await response.text();

    	    // Remove typing indicator
    	    messages.removeChild(typingIndicator);

    	    // Add bot message
    	    const botMsg = document.createElement('div');
    	    botMsg.className = 'message botMessage';
    	    botMsg.textContent = data;
    	    messages.appendChild(botMsg);
    	    messages.scrollTop = messages.scrollHeight;

    	  } catch (err) {
    	    console.error('Chat error:', err);

    	    // Remove typing indicator
    	    if (messages.contains(typingIndicator)) {
    	      messages.removeChild(typingIndicator);
    	    }

    	    const botMsg = document.createElement('div');
    	    botMsg.className = 'message botMessage';
    	    botMsg.textContent = 'Sorry, I encountered an error. Please try again.';
    	    messages.appendChild(botMsg);
    	    messages.scrollTop = messages.scrollHeight;

    	  } finally {
    	    sendButton.disabled = false;
    	  }
    	}


    // Simulate LLM response for demo purposes
    async function simulateLLMResponse(question) {
      // Simulate network delay
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      const lowerQuestion = question.toLowerCase();
      
      if (lowerQuestion.includes('total') || lowerQuestion.includes('spent')) {
        const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
        return `You've spent a total of ${formatCurrency(total)} across ${expenses.length} transactions.`;
      }
      
      if (lowerQuestion.includes('category') || lowerQuestion.includes('categories')) {
        const categoryTotals = {};
        expenses.forEach(exp => {
          categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
        });
        const topCategory = Object.keys(categoryTotals).reduce((a, b) => 
          categoryTotals[a] > categoryTotals[b] ? a : b, 'None'
        );
        return `Your top spending category is ${topCategory} with ${formatCurrency(categoryTotals[topCategory] || 0)}.`;
      }
      
      if (lowerQuestion.includes('budget') || lowerQuestion.includes('save')) {
        return 'Here are some budgeting tips: 1) Track all expenses, 2) Set realistic spending limits, 3) Review monthly, 4) Cut unnecessary subscriptions, 5) Use the 50/30/20 rule (needs/wants/savings).';
      }
      
      if (lowerQuestion.includes('month') || lowerQuestion.includes('monthly')) {
        const now = new Date();
        const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
        const monthTotal = expenses
          .filter(exp => exp.date >= monthStart)
          .reduce((sum, exp) => sum + exp.amount, 0);
        return `This month you've spent ${formatCurrency(monthTotal)}.`;
      }
      
      // Default responses
      const responses = [
        "I can help you analyze your spending patterns and provide financial insights!",
        "Would you like me to break down your expenses by category or time period?",
        "I can help you understand your spending habits better. What would you like to know?",
        "Feel free to ask about your budget, spending trends, or financial tips!"
      ];
      
      return responses[Math.floor(Math.random() * responses.length)];
    }

    // Utility Functions
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
      }).format(amount);
    }

    function formatDate(dateString) {
      return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // Toast Notifications
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type} show`;
      toast.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Navigation
    function handleNavigation(e) {
      e.preventDefault();
      const section = e.currentTarget.dataset.section;
      
      // Update active nav
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      e.currentTarget.classList.add('active');
      
      // Show appropriate section (for now just dashboard)
      console.log('Navigate to:', section);
    }

    // Export Data
    function exportData() {
      const csvData = [
        ['Date', 'Title', 'Category', 'Amount', 'Description'],
        ...expenses.map(exp => [
          exp.date,
          exp.title,
          exp.category,
          exp.amount,
          exp.description || ''
        ])
      ].map(row => row.join(',')).join('\n');
      
      const blob = new Blob([csvData], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `expenses_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
      
      showToast('Expenses exported successfully!');
    }

    // Budget Modal
    function showBudgetModal() {
      const budget = prompt('Set your monthly budget:', monthlyBudget || '');
      if (budget !== null && budget !== '') {
        monthlyBudget = parseFloat(budget);
        localStorage.setItem('monthlyBudget', monthlyBudget.toString());
        
        document.getElementById('budgetSection').style.display = 'block';
        document.getElementById('budgetTotal').textContent = formatCurrency(monthlyBudget);
        updateBudgetProgress();
        
        showToast('Budget updated successfully!');
      }
    }

    // Theme Toggle (placeholder)
    function toggleTheme() {
      showToast('Dark theme coming soon!');
    }

    // Show all expenses
    function showAllExpenses() {
      renderRecentExpenses(expenses.length);
    }

    // Initialize charts after page load
    setTimeout(() => {
      if (expenses.length > 0) {
        showChart('category');
      }
    }, 1000);

  </script>
</body>
</html>